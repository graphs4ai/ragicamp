# Example configuration showcasing MLflow, Ragas, and State Management
# This demonstrates all new v0.2 features

agent:
  type: fixed_rag
  name: "gemma_rag_mlflow_demo"
  top_k: 5
  system_prompt: null

model:
  type: huggingface
  model_name: "google/gemma-2-2b-it"
  device: "cuda"
  load_in_4bit: true
  max_tokens: 150
  temperature: 0.7

dataset:
  name: natural_questions
  split: validation
  num_examples: 20  # Small for quick demo
  filter_no_answer: true
  cache_dir: "data/datasets"

retriever:
  type: dense
  name: "wiki_retriever"
  artifact_path: "wikipedia_simple_chunked_1024_overlap_128"
  embedding_model: "all-MiniLM-L6-v2"
  index_type: "flat"

metrics:
  # Traditional metrics (custom)
  - exact_match
  - f1
  
  # Semantic metrics (custom)
  - bertscore
  
  # RAG-specific metrics (Ragas) - NEW!
  - faithfulness
  - answer_relevancy
  - context_precision
  
  # Can also use ragas_ prefix for clarity
  # - ragas_faithfulness
  # - ragas_answer_relevancy

evaluation:
  mode: both  # generate + evaluate in one go
  batch_size: 8
  num_examples: null  # Use dataset.num_examples
  
  # Per-question checkpointing (existing feature)
  checkpoint_every: 5
  resume_from_checkpoint: true
  retry_failures: true
  
  # Phase-level state management (NEW!)
  save_state: true  # Default: true
  state_file: null  # Auto: outputs/{name}_state.json
  force_rerun_phases: []  # e.g., ["metrics"] to rerun only metrics

output:
  save_predictions: true
  output_path: "outputs/mlflow_ragas_demo.json"
  output_dir: "outputs"

# MLflow Experiment Tracking (NEW!)
mlflow:
  enabled: true  # Set false to disable
  experiment_name: "rag_demos"  # Groups related experiments
  run_name: "gemma_ragas_integration"  # Specific run name
  tracking_uri: null  # null = use ./mlruns (default)
  
  # Tags for organization
  tags:
    model_family: "gemma"
    experiment_type: "demo"
    dataset: "natural_questions"
    features: "mlflow_ragas_state"
  
  # Artifact logging
  log_artifacts: true  # Log predictions, configs, etc.
  log_models: false  # Set true for model versioning (slower)

# Hyperparameter Optimization (NEW! - not yet active)
optuna:
  enabled: false  # Coming soon!
  n_trials: 20
  study_name: "rag_optimization"
  storage: null  # e.g., "sqlite:///optuna.db"
  direction: "maximize"
  metric_to_optimize: "f1"
  
  # Parameter search spaces
  search_params:
    top_k: [1, 20]  # Range for integer params
    temperature: [0.1, 2.0]  # Range for float params
    # max_tokens: [50, 300]

# Optional: Training/RL configuration (for future)
training: null
